#!/bin/sh

browse() {
    folder="$1"

    # List items
    items=$(find "$folder" -mindepth 1 -maxdepth 1 | sort)

    # Show menu
    selection=$(printf "%s\n" $items | wofi --dmenu --prompt "Select:") || exit

    if [ -d "$selection" ]; then
        browse "$selection"
    elif [ -f "$selection" ]; then
        choice=$(printf "nvim\nvscode" | wofi --dmenu --prompt "Open with:") || exit

        case "$choice" in
            nvim)
                nvim "$selection"
                ;;
            vscode)
                # Detect top-level project folder under ~/code
                project_root=$(echo "$selection" | sed -E "s|^$HOME/code/([^/]+).*|\1|")
                code-oss --goto "$selection" "$HOME/code/$project_root"
                ;;
        esac
    fi
}

# Start from ~/code
browse "$HOME/code"

