#!/bin/sh
# ~/.local/bin/bookmark-clip.sh
# POSIX-compliant: select a bookmark and type it out
# Requires: wofi, xdotool or ydotool

BOOKMARK_FILE="$HOME/.local/share/bookmarks"

# Check if file exists
[ ! -f "$BOOKMARK_FILE" ] && {
    printf 'Bookmark file not found at %s\n' "$BOOKMARK_FILE" >&2
    exit 1
}

# Select a bookmark with wofi, ignoring empty lines
selection=$(grep -v '^[[:space:]]*$' "$BOOKMARK_FILE" | wofi --dmenu --prompt="Select bookmark:")

# Exit if nothing selected
[ -z "$selection" ] && exit 0

# Try to type out the selection, fallback to clipboard
if command -v wtype >/dev/null 2>&1; then
    if printf '%s' "$selection" | wtype - 2>/dev/null; then
        printf 'Typed: %s\n' "$selection" >&2
    else
        printf 'Virtual keyboard not supported, using clipboard instead.\n' >&2
        printf '%s' "$selection" | wl-copy
        printf 'Copied to clipboard: %s\n' "$selection" >&2
    fi
elif command -v ydotool >/dev/null 2>&1; then
    printf '%s' "$selection" | ydotool type -
else
    # Fallback to clipboard
    printf '%s' "$selection" | wl-copy
    printf 'Copied to clipboard: %s\n' "$selection" >&2
fi

# Optional: give feedback
printf 'Typed: %s\n' "$selection" >&2

